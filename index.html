<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>🔥Ember - The Ephemeral Social Network – Where Posts Live and Die</title>
  <script type="module">
    import WebTorrent from "https://cdn.jsdelivr.net/npm/webtorrent@2.6.8/dist/webtorrent.min.js";
    window.WebTorrent = WebTorrent;
  </script>
<script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/toxicity@1.2.2/dist/toxicity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nsfwjs@4.2.1/dist/browser/nsfwjs.min.js"></script>
<script
  src="https://cdn.jsdelivr.net/npm/dompurify@3.2.6/dist/purify.min.js"
  integrity="sha384-JEyTNhjM6R1ElGoJns4U2Ln4ofPcqzSsynQkmEc/KGy6336qAZl70tDLufbkla+3"
  crossorigin="anonymous"></script>

        
  <link rel="stylesheet" href="style.css">

</head>
<body>
    
  <div id="identity-creation-overlay" class="loading-overlay" style="display: none;">
    <div id="identity-modal-content">
    <h2>Securing Your Identity</h2>
    <p>To protect the network, we need to perform a quick, one-time setup.</p>
    
    <div id="identity-step-0-disclaimer">
        <div class="risk-disclaimer">
            <h3>Welcome to a Public P2P Network</h3>
            <p><strong>This is not a private messenger.</strong> Please acknowledge the following to continue:</p>
            <ul>
                <li>Your IP address may be visible to other users.</li>
                <li>Messages are not end-to-end encrypted and can be read by peers who relay your posts.</li>
                <li>Your activity is traceable.</li>
            </ul>
        </div>
        <button id="acknowledge-button" class="primary-button">I Understand, Continue</button>
    </div>
    
    <div id="identity-step-1-calibrate" style="display: none;">
        <div class="spinner"></div>
        <div id="identity-status-text"><strong>Step 1/2:</strong> Calibrating network difficulty...</div>
    </div>

    <div id="identity-step-2-pow" style="display: none;">
        </div>
    <div id="identity-step-3-prompt" style="display: none;">
        </div>
</div>
  </div>
  <div id="loading" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div>🔥 Igniting the Ember Network...</div>
      <div style="font-size:12px;margin-top:10px;color:#ff8c42">No servers, just flames</div>
    </div>
  </div>

  <div id="app-container">

    <div class="app-column" id="column-controls">
     
        <h1>🔥 Ember</h1>
        <p class="tagline">Fan the flames or watch them die</p>
              <div id="controls-footer">
        <button id="theme-toggle-button" class="secondary-button">☀️ Light Mode</button>
      </div>
      
              <div id="compose">
          <textarea id="post-input" placeholder="Write something ephemeral…" maxlength="500"></textarea>
          <div class="image-preview" id="image-preview" style="display:none;">
            <img id="preview-img" />
            <button onclick="removeImage()">✕</button>
          </div>
          <div class="compose-footer">
            <input type="file" id="image-input" accept="image/*" style="display:none;" onchange="handleImageSelect(this)" />
            <button onclick="document.getElementById('image-input').click()" class="image-button">📷</button>
            <span class="char-count"><span id="char-current">0</span>/500</span>
            <button id="send-button" class="primary-button" onclick="createPostWithTopics()">🔥 Light it up</button>
          </div>
        </div>
      <div id="status">
        <span><span class="status-indicator" id="status-dot"></span>Connected to <span id="peer-count">0</span> peers</span>
        <span><span id="post-count">0</span> posts alive</span>
      </div>
      <div class="network-info" id="network-info" style="display:none">
        <strong>Your Network ID:</strong> <code id="network-id"></code><br />
        <small>Share this with friends to connect directly</small>
      </div>

        <button id="clear-data-button" class="secondary-button" onclick="clearLocalData()">
  🗑️ Clear Local Data
</button>

        
        <footer>
    <p class="network-notice">
        ⚠️ Public Network: Do not share sensitive information.
    </p>
</footer>
        
    </div>

    <div class="app-column" id="column-feed">
      <div class="column-header">
        <h2>The Void</h2>
      </div>
      <div class="topics-section">
  <h3>📡 Topics</h3>
  <div class="subscribed-topics" id="subscribed-topics">
    <div class="topic-tag active" data-topic="#general">#general</div>
    <div class="topic-tag active" data-topic="#ember">#ember</div>
  </div>
  <div class="topic-input-wrapper">
    <input type="text" id="topic-input" placeholder="Subscribe to #topic" />
    <button onclick="subscribeToTopic()" class="subscribe-button">+</button>
  </div>
  <div class="topic-stats" id="topic-stats"></div>
</div>

<div class="feed-controls">
  <div class="topic-filter">
    <label>Filter by topic:</label>
    <select id="topic-filter" onchange="filterByTopic()">
      <option value="">All Topics</option>
      <option value="#general">#general</option>
      <option value="#ember">#ember</option>
    </select>
  </div>
  <div class="feed-mode">
    <button class="mode-button active" onclick="setFeedMode('all')">All Posts</button>
    <button class="mode-button" onclick="setFeedMode('topics')">My Topics</button>
  </div>
</div>
      
      
      <div id="posts">
        </div>
    </div>

    <div class="app-column" id="column-bonfire">
      <div class="column-header">
        <h2>The Bonfire</h2>
      </div>
      <div id="bonfire-content">
        </div>
    </div>

  </div>

    <script type="module" src="main.js"></script>

</body>
</html>
